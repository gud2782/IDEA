<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header_content :: header_content" />
<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>

<!--navbar-->
<div th:replace="fragments/navbar_content :: navbar_content"/>
<!--navbar end-->



    <link rel="stylesheet" href="/css/style_form.css">

<body>
<div class="wrapper">
    <div class="title-text">
        <div class="title login">
            헌혈 정보 등록
        </div>
    </div>
    <div class="form-container">

        <div class="form-inner">
            <form id="donationForm" th:action="@{/donation/new}" th:object="${donationForm}" method="post" class="login" autocomplete="off">
                <div class="field">
                <select name="registerIdx" id="register" class="form-control"  th:onchange="changeValues()" >
                    <option value="">강아지선택</option>
                    <option th:each="register : ${registers}"
                            th:value="|${register.registerIdx},${register.aniId},${register.kind},${register.neutralization}|"
                            th:text="${register.aniName}"
                    />
                </select>
                </div>
                <div class="field">
                    <input type="text" id="aniId" th:id="aniId" th:for="register" class="form-control" th:field="*{register.aniId}" placeholder="동물등록번호" required>
                </div>
                <div class="field">
                    <input type="text" id="DWeight" th:id="DWeight" th:for="DWeight" class="form-control" th:field="*{DWeight}" placeholder="몸무게" required>
                </div>
                <div class="field">
                    <input type="text" id="kind" th:id="kind" th:for="kind" class="form-control" th:field="*{kind}" placeholder="견종" required>
                </div>
                <div class="field">
                    <input type="text" id="DDate" th:id="DDate" th:for="DDate" class="form-control" th:field="*{DDate}" placeholder="헌혈 날짜" required>
                </div>
                <div class="field">
                    <input type="text" id="DHos" th:id="DHos" th:for="DHos" class="form-control" th:field="*{DHos}" placeholder="헌혈 기관" required>
                </div>
                <div class="field">
                    <input type="text" id="type" th:id="type" th:for="type" class="form-control" th:field="*{type}" placeholder="혈액형" required>
                </div>
                <div class="field">
                    <input type="text" id="DPack" th:id="DPack" th:for="DPack" class="form-control" th:field="*{DPack}" placeholder="혈액양" required>
                </div>

                <div class="field btn">
                    <div class="btn-layer"></div>
                    <input type="submit" value="등록" onclick="toAjax()">
                </div>


            </form>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" th:inline="javascript">
    function toAjax() {

        // console.log("1");

        // var aniName =$("#aniName").val();
        var aniId =$("#aniId").val();
        var kind =$("#kind").val();
        var DWeight =$("#DWeight").val();
        var DDate =$("#DDate").val();
        var DHos =$("#DHos").val();
        var type =$("#type").val();
        var DPack =$("#DPack").val();



        // var donationForm = $("#donationForm");
        // var x = document.getElementById("donationForm");
        // var text="";
        // var i;
        // for (i=0; 1<x.length; i++){
        //     text += x.elements[i].value + "<br>";
        //
        //     }
        // console.log(text);



        let http = new XMLHttpRequest();
        let url = 'https://metadata-api.klaytnapi.com/v1/metadata';
        let data= {
            "metadata": {
                "name": "형우테스트",
                "description": "description example for kip17 token",
                "image": "https://metadata-store.klaytnapi.com/e2d83vdb-c108-823c-d5f3-69vdf2d871c51/4a85e6be-3215-93e6-d8a9-3a7d633584e7.png",
                // "aniName": aniName,
                "aniId" : aniId,
                "kind" : kind,
                "DWeight" : DWeight,
                "DDate" : DDate,
                "DHos" : DHos,
                "type" : type,
                "DPack" : DPack

            }
        }

        let aJson = new Object();
        aJson.metadata = {
            "name": "형우테스트",
            "description": "description example for kip17 token",
            "image": "https://metadata-store.klaytnapi.com/e2d83vdb-c108-823c-d5f3-69vdf2d871c51/4a85e6be-3215-93e6-d8a9-3a7d633584e7.png",
            // "aniName": aniName,
            "aniId" : aniId,
            "kind" : kind,
            "DWeight" : DWeight,
            "DDate" : DDate,
            "DHos" : DHos,
            "type" : type,
            "DPack" : DPack
        }
        console.log("aJson.metadata >>> "+aJson.metadata.aniId)
        console.log("aJson.metadata >>> "+aJson.metadata.kind)
        console.log("aJson.metadata >>> "+aJson.metadata.DWeight)
        console.log("aJson.metadata >>> "+aJson.metadata.DDate)
        console.log("aJson.metadata >>> "+aJson.metadata.DHos)
        console.log("aJson.metadata >>> "+aJson.metadata.type)
        console.log("aJson.metadata >>> "+aJson.metadata.DPack)

        http.open('POST', url, true);



//Send the proper header information along with the request
        http.setRequestHeader('Content-type', 'application/json');
        http.setRequestHeader('Authorization', 'Basic S0FTS1IwQTNDMVA4SUNRS0Q5V1dJSThTOmZHeVZodlFieUh1dTdHdWl1TjV2eWdodmdlSU9fcXl5ZlhqYUlUVkc=');
        http.setRequestHeader('x-chain-id', '1001');
        http.onreadystatechange = function() {//Call a function when the state changes.
            if(http.readyState == 4 && http.status == 200) {

                alert(http.responseText);


            }
        }
        http.send(JSON.stringify(data));

    };
</script>
<script>
    const loginText = document.querySelector(".title-text .login");
    const loginForm = document.querySelector("form.login");
    const loginBtn = document.querySelector("label.login");
    const signupBtn = document.querySelector("label.signup");
    // const signupLink = document.querySelector("form .signup-link a");
    signupBtn.onclick = (()=>{
        loginForm.style.marginLeft = "-50%";
        loginText.style.marginLeft = "-50%";
    });
    loginBtn.onclick = (()=>{
        loginForm.style.marginLeft = "0%";
        loginText.style.marginLeft = "0%";
    });
    signupLink.onclick = (()=>{
        signupBtn.click();
        return false;
    });
</script>
<script th:inline="javascript">

    function getType(Event) {
        document.getElementById('result').innerText =
            Event.target.value;
    }
    function changeValues() {


        //select된 값 가져오면서 , 기준 파싱
        let selectOption = document.getElementById("register").value.split(",");

        //변수 선언
        let aniId,kind,neutralization;

        //각각 파싱된 변수들 저장
        for (let idx=0; idx <  4; idx++){
            let value = selectOption [idx];
            if(idx == 1){
                aniId= value;
            }else if(idx == 2){
                kind= value;
            }else if(idx==3){
                neutralization= value;
            }
        }


        //input id값으로 저장된 값 설정 및 뿌려주기

        document.getElementById('aniId').value = aniId;
        document.getElementById('kind').value = kind;
        document.getElementById('neutralization').value = neutralization;

    }




</script>
<script type="text/javascript">
    $(document).ready(function () {
        $.datepicker.regional['ko'] = {
            closeText: '닫기',
            prevText: '이전달',
            nextText: '다음달',
            currentText: '오늘',
            monthNames: ['1월(JAN)','2월(FEB)','3월(MAR)','4월(APR)','5월(MAY)','6월(JUN)',
                '7월(JUL)','8월(AUG)','9월(SEP)','10월(OCT)','11월(NOV)','12월(DEC)'],
            monthNamesShort: ['1월','2월','3월','4월','5월','6월',
                '7월','8월','9월','10월','11월','12월'],
            dayNames: ['일','월','화','수','목','금','토'],
            dayNamesShort: ['일','월','화','수','목','금','토'],
            dayNamesMin: ['일','월','화','수','목','금','토'],
            weekHeader: 'Wk',
            dateFormat: 'yy-mm-dd',
            firstDay: 0,
            isRTL: false,
            showMonthAfterYear: true,
            yearSuffix: '',
            buttonText: "달력",
            changeMonth: true,
            changeYear: true,
            showButtonPanel: true,
            yearRange: 'c-99:c+99',
        };
        $.datepicker.setDefaults($.datepicker.regional['ko']);

        $('#DDate').datepicker();
        $('#DDate').datepicker("option", "maxDate", $("#DDate").val());


    });
</script>

</html>


