<!DOCTYPE html>
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header_content :: header_content" />

	<!-- Font-->
	<link rel="stylesheet" type="text/css" href="/css/opensans-font.css">
	<link rel="stylesheet" type="text/css" href="/fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">
	<!-- Main Style Css -->
<!--    <link rel="stylesheet" href="/css/style_blood.css"/>-->
	<script type="text/javascript" src="/js/jsQR.js"></script>
</head>

<!--navbar-->
<div th:replace="fragments/navbar_content :: navbar_content"/>
<!--navbar end-->
<body>
	<div class="page-content">
		<div class="form-v1-content">
			<div class="wizard-form">
		        <form class="form-register" action="#" method="post">
		        	<div id="form-total">
						<!-- SECTION 1 -->
						<h2>
							<p class="step-icon"><span>01</span></p>
							<span class="step-text">ì¡°íšŒ</span>
						</h2>
						<section>
							<div class="inner">
								<div class="wizard-header">
									<h3 class="heading">ë™ë¬¼ë“±ë¡ë²ˆí˜¸ ì¡°íšŒ</h3>
									<p>ë°˜ë ¤ê²¬ ë“±ë¡ ë‹¹ì‹œ ì…ë ¥í•œ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
								</div>
								<div class="form-row">
									<div class="form-holder form-holder-1">
										<input type="text" name="find_bank" id="find_bank" placeholder="'-'ì—†ì´ ì…ë ¥í•´ì£¼ì„¸ìš”." class="form-control">
									</div>
									<div class="form-holder form-holder-4">
										<input type="button" name="find_bank" id="lookup" value="ì¡°íšŒ" class="form-control" >
									</div>
								</div>
								<div class="form-row">
									<div class="form-holder form-holder-1">
										<input type="text" name="find_bank" id="aniId" placeholder="ë™ë¬¼ë“±ë¡ë²ˆí˜¸" class="form-control">
									</div>
									<div class="form-holder form-holder-4">
										<input type="button" name="find_bank" id="qrcode" value="QRì½”ë“œ" class="form-control" >
									</div>
								</div>
								<div class="qrBox" >
									<div class="modalQRcode">
										<div class="modal_content">
											<div id="frame">
												<div id="loadingMessage" hidden>
													ğŸ¥ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br/>ì›¹ìº ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤
												</div> <!-- loadingMessage-->
												<canvas id="canvas" style="width: 400px; height: 300px"></canvas>
											</div> <!-- frame-->
										</div> <!-- modal_content-->
									</div><!-- modalQRcode-->
								</div>
							</div>
						</section>



						<!-- SECTION 2 -->
			            <h2>
			            	<p class="step-icon"><span>02</span></p>
			            	<span class="step-text">ë“±ë¡</span>
			            </h2>
			            <section>
			                <div class="inner">
			                	<div class="wizard-header">
									<h3 class="heading">í—Œí˜ˆê²¬ ì •ë³´ ë“±ë¡</h3>
									<p>Please enter your infomation and proceed to the next step so we can build your accounts.  </p>
								</div>
								<div class="form-row">
									<div class="form-holder">
										<fieldset>
											<legend>ë°˜ë ¤ê²¬ ì´ë¦„</legend>
											<input type="text" class="form-control" id="first-name" name="first-name" placeholder="ì—°ì´" required>
										</fieldset>
									</div>
									<div class="form-holder">
										<fieldset>
											<legend>ë™ë¬¼ë“±ë¡ë²ˆí˜¸</legend>
											<input type="text" class="form-control" id="did" name="last-name" placeholder="410160020250774" required>
										</fieldset>
									</div>
								</div>
								<div class="form-row">
									<div class="form-holder">
										<fieldset>
											<legend>ëª¸ë¬´ê²Œ</legend>
											<input type="text" name="your_email" id="your_email" class="form-control" pattern="[^@]+@[^@]+.[a-zA-Z]{2,6}" placeholder="3.0Kg" required>
										</fieldset>
									</div>
									<div class="form-holder">
										<fieldset>
											<legend>ê²¬ì¢…</legend>
											<input type="text" class="form-control" id="phone" name="phone" placeholder="í† ì´í‘¸ë“¤" required>
										</fieldset>
									</div>
								</div>
								<div class="form-row">
									<div class="form-holder form-holder-2">

									</div>
								</div>
								<div class="form-row">
									<div class="form-holder form-holder-2">

									</div>
								</div>
								<div class="form-row">
									<div class="form-holder form-holder-2">
										<fieldset>
											<legend>í—Œí˜ˆ ê¸°ê´€</legend>
											<input type="text" class="form-control" id="phone" name="phone" placeholder="ê±´êµ­ëŒ€í•™êµ ìˆ˜ì˜ë³‘ì›" required>
										</fieldset>
									</div>
								</div>
								<div class="form-row form-row-date">
									<div class="form-holder form-holder-2">
<!--										<label class="special-label">í˜ˆì•¡í˜•</label>-->
										<select name="month" id="month">
											<option value="MM" disabled selected>í˜ˆì•¡í˜•</option>
											<option value="16">DEA 1.1</option>
											<option value="17">DEA 1.2</option>
											<option value="18">DEA 4</option>
											<option value="19">DEA 7</option>
										</select>
										<div class="form-row">
											<div class="form-holder2 form-holder-2">
												<input type="text" class="form-control input-border" id="ssn" name="ssn" placeholder="í—Œí˜ˆë‚ ì§œ" required>
											</div>
										</div>

									</div>
								</div>

							</div>
			            </section>

			            <!-- SECTION 3 -->
			            <h2>
			            	<p class="step-icon"><span>03</span></p>
			            	<span class="step-text">ì™„ë£Œ</span>
			            </h2>
			            <section>
			                <div class="inner">
			                	<div class="wizard-header">
									<h3 class="heading">THANK YOU!</h3>
									<p>Please enter your infomation and proceed to the next step so we can build your accounts.</p>
								</div>
								<div class="form-row">
			                		<div class="form-holder form-holder-2">
			                			<input type="radio" class="radio" name="radio1" id="plan-1" value="plan-1">
			                			<label class="plan-icon plan-1-label" for="plan-1">
		                					<img src="/img/form-v1-icon-2.png" alt="pay-1">
			                			</label>
			                			<div class="plan-total">
		                					<span class="plan-title">ì ‘ì¢… ì •ë³´ ë“±ë¡</span>
		                					<p class="plan-text">Pellentesque nec nam aliquam sem et volutpat consequat mauris nunc congue nisi.</p>
		                				</div>
			                			<input type="radio" class="radio" name="radio1" id="plan-2" value="plan-2">
			                			<label class="plan-icon plan-2-label" for="plan-2">
			                					<img src="/img/form-v1-icon-2.png" alt="pay-1">
			                			</label>
			                			<div class="plan-total">
		                					<span class="plan-title">ìˆ˜í˜ˆê²¬ ì •ë³´ ë“±ë¡</span>
		                					<p class="plan-text">Pellentesque nec nam aliquam sem et volutpat consequat mauris nunc congue nisi.</p>
		                				</div>
										<input type="radio" class="radio" name="radio1" id="plan-3" value="plan-3" checked>
										<label class="plan-icon plan-3-label" for="plan-3">
		                					<img src="/img/form-v1-icon-3.png" alt="pay-2">
										</label>
										<div class="plan-total">
		                					<span class="plan-title">ë§ˆì´í˜ì´ì§€</span>
		                					<p class="plan-text">Pellentesque nec nam aliquam sem et volutpat consequat mauris nunc congue nisi.</p>
		                				</div>
			                		</div>
			                	</div>
							</div>
			            </section>
		        	</div>
		        </form>
			</div>
		</div>
	</div>
</body>
<script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/jquery.steps.js"></script>
<script src="/js/main.js"></script>

<script type="text/javascript">
	$(function(){
		$("#qrcode").click(function() {
			$(".modalQRcode").fadeIn();

			var video = document.createElement("video");
			var canvasElement = document.getElementById("canvas");
			var canvas = canvasElement.getContext("2d");
			var loadingMessage = document.getElementById("loadingMessage");
			var aniId = document.getElementById("aniId");
			function drawLine(begin, end, color) {
				canvas.beginPath();
				canvas.moveTo(begin.x, begin.y);
				canvas.lineTo(end.x, end.y);
				canvas.lineWidth = 4;
				canvas.strokeStyle = color;
				canvas.stroke();
			}
			// ì¹´ë©”ë¼ ì‚¬ìš©ì‹œ
			navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function(stream) {
				video.srcObject = stream;
				video.setAttribute("playsinline", true);      // iOS ì‚¬ìš©ì‹œ ì „ì²´ í™”ë©´ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒì„ ì „ë‹¬
				video.play();
				requestAnimationFrame(tick);
			});
			async function tick() {
				loadingMessage.innerText = "âŒ› ìŠ¤ìº” ê¸°ëŠ¥ì„ í™œì„±í™” ì¤‘ì…ë‹ˆë‹¤."
				if(video.readyState === video.HAVE_ENOUGH_DATA) {
					loadingMessage.hidden = true;
					canvasElement.hidden = false;
					// outputContainer.hidden = false;
					// ì½ì–´ë“¤ì´ëŠ” ë¹„ë””ì˜¤ í™”ë©´ì˜ í¬ê¸°
					canvasElement.height = video.videoHeight;
					canvasElement.width = video.videoWidth;
					canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
					var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
					var code = jsQR(imageData.data, imageData.width, imageData.height, {
						inversionAttempts : "dontInvert",
					});
					// QRì½”ë“œ ì¸ì‹ì— ì„±ê³µí•œ ê²½ìš°
					if(code) {
						// ì¸ì‹í•œ QRì½”ë“œì˜ ì˜ì—­ì„ ê°ì‹¸ëŠ” ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” í…Œë‘ë¦¬ ìƒì„±
						drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#FFCE49");
						drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#FFCE49");
						drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#FFCE49");
						drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#FFCE49");


						// QRì½”ë“œ ë©”ì‹œì§€ ì¶œë ¥
						aniId.innerHTML = code.data;

						const aniId2 = code.data;
						$('#aniId').val(aniId2);
						console.log(`aniId:${aniId}`);
						//ì¹´ë©”ë¼ ì‚¬ë¼ì§€ê¸°
						$(".modalQRcode").fadeOut();



						//ì„¸í›ˆ:í•œë‚˜ = did:aniId
						// $.ajax({
						// 	url:`http://192.168.43.99:3000/api/pet/get/all/petInfos/${did}`,
						// 	type:"GET",
						// 	contentType: "application/json",
						// 	success: function(result) {
						// 		if (result) {
						// 			console.log(result.peterpet);
						// 			// location.href = "/home/blood";
						// 		}
						// 		else {
						// 			alert("ì ì‹œ í›„ì— ì‹œë„í•´ì£¼ì„¸ìš”.");
						// 		}
						// 	},
						// 	error: function() {
						// 		alert("ì—ëŸ¬ ë°œìƒ");
						// 	} })
						// returnì„ ì¨ì„œ í•¨ìˆ˜ë¥¼ ë¹ ì ¸ë‚˜ê°€ë©´ QRì½”ë“œ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œëœë‹¤.
						return;
					}
					// QRì½”ë“œ ì¸ì‹ì— ì‹¤íŒ¨í•œ ê²½ìš°
					else {
						// outputMessage.hidden = false;
						// outputData.parentElement.hidden = true;
					}
				}
				requestAnimationFrame(tick);


			}


		});
		$("#canvas").click(function(){
			$(".modalQRcode").fadeOut();
		});
	});
</script>
<script type="text/javascript">
	// document.addEventListener("DOMContentLoaded",
</script>

<!--footer -->
<div th:replace="fragments/footer_content :: footer_content" />
<!--footer-end -->


<!-- Bootstrap -->
<script src="/js/bootstrap.min.js"></script>


</html>